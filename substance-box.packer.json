{
  "variables": {
    "ssh_name": "packer",
    "ssh_pass": "packer",
    "hostname": "susbtance"
  },
  "builders": [{
    "type": "virtualbox-ovf",
    "vm_name": "substance",
    "output_directory": "build/substance-box",

    "source_path": "build/substance-base/substance-base.ovf",
     
    "http_directory" : "support",
    "http_port_min" : 10000,
    "http_port_max" : 20000,

    "ssh_username": "{{user `ssh_name`}}",
    "ssh_password": "{{user `ssh_pass`}}",
    "ssh_wait_timeout": "20m",
    "ssh_pty": true,

    "shutdown_command": "echo {{user `ssh_pass`}} | sudo -S shutdown -P now",

    "guest_additions_mode": "disable",
    "vboxmanage": [
      ["modifyvm", "{{.Name}}", "--nic2", "nat"]
    ]
  }],

  "provisioners": [ 
    {
      "type": "salt-masterless",
      "local_state_tree": "./salt/salt",
      "local_pillar_roots": "./salt/pillar",
      "minion_config": "./salt/minion",
      "log_level": "debug",
      "skip_bootstrap": true
    },
    {
      "type": "shell",
      "scripts": [ 
        "scripts/cleanup.sh",
        "scripts/compress.sh" 
       ],
      "execute_command": " echo {{user `ssh_pass`}} | {{.Vars}} sudo -S -E bash '{{.Path}}'"
    }
  ]
}
